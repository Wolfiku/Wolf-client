<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wolf Client - Homescreen</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: url("../../assets/backgrounds/wolf_client_background_1.png") no-repeat center center/cover;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      height: 100vh;
      overflow: hidden;
    }

    .logo {
      margin-top: 40px;
      width: 150px;
    }

    .search-bar {
      margin: 20px;
      width: 80%;
      max-width: 500px;
    }

    .search-bar input {
      width: 100%;
      padding: 10px;
      border-radius: 12px;
      border: none;
      font-size: 16px;
    }

    .tools {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      width: 90%;
      max-width: 900px;
      margin-top: 20px;
      overflow-y: auto;
      flex-grow: 1;
    }

    .tool {
      background: rgba(0, 50, 0, 0.8);
      border-radius: 12px;
      padding: 15px;
      text-align: center;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .tool:hover {
      transform: scale(1.05);
    }

    .tool img {
      width: 60px;
      height: 60px;
      object-fit: contain;
      margin-bottom: 10px;
    }

    .tool .name {
      font-weight: bold;
    }

    .tool .name.missing {
      color: red;
    }

    .buttons {
      position: fixed;
      bottom: 20px;
      width: 90%;
      display: flex;
      justify-content: space-between;
    }

    .btn {
      background: rgba(0, 100, 0, 0.8);
      padding: 10px 20px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: bold;
    }

    .btn:hover {
      background: rgba(0, 150, 0, 0.8);
    }
  </style>
</head>
<body>
  <img src="../../assets/wolfclientlogo.png" alt="Wolf Client Logo" class="logo">
  
  <div class="search-bar">
    <input type="text" id="search" placeholder="Search tools...">
  </div>

  <div class="tools" id="tools"></div>

  <div class="buttons">
    <div class="btn" id="listBtn">Tools</div>
    <div class="btn" id="settingsBtn">Settings</div>
  </div>

  <script>
    const toolsContainer = document.getElementById("tools");
    const searchInput = document.getElementById("search");

    let tools = [];

    async function loadTools(){
      const url = "../list/tools.list";
      let text;
      try {
        const res = await fetch(url, {cache:"no-store"});
        if(!res.ok) throw new Error("File missing");
        text = await res.text();
      } catch {
        toolsContainer.innerHTML = "<p style='color:red;'>Fatal Error: tools.list missing.</p>";
        return;
      }

      tools = [];
      const lines = text.split("\n").map(l => l.trim());
      let emptyCount = 0;
      for (let line of lines){
        if(line === ""){
          emptyCount++;
          if(emptyCount >= 3) break;
          continue;
        }
        emptyCount = 0;
        if(line === "[end]") break;

        const [path, meta] = line.split("=");
        if(!path || !meta){
          console.warn("Skipping invalid line:", line);
          continue;
        }

        let entry = {
          file: path.trim(),
          name: "Name fehlend",
          kategorie: "Standard",
          author: null,
          iconfile: "../../system/systemdata/icons/defaulttool.png"
        };

        const attrs = meta.replace(/^\[|\]$/g,"").split(",");
        for(let attr of attrs){
          const [key, value] = attr.split("=");
          if(key && value){
            entry[key.trim().toLowerCase()] = value.trim();
          }
        }

        // Name fehlend rot markieren
        if(entry.name === "Name fehlend"){
          entry.nameClass = "missing";
        } else {
          entry.nameClass = "";
        }

        // Unbekannte Kategorie â†’ Standard
        if(!entry.kategorie) entry.kategorie = "Standard";

        tools.push(entry);
      }

      renderTools();
    }

    function renderTools(){
      toolsContainer.innerHTML = "";
      const query = searchInput.value.toLowerCase();
      tools
        .filter(t => t.name.toLowerCase().includes(query) || (t.author && t.author.toLowerCase().includes(query)))
        .forEach(tool => {
          const div = document.createElement("div");
          div.className = "tool";
          div.innerHTML = `
            <img src="${tool.iconfile}" alt="icon" onerror="this.src='../../system/systemdata/icons/defaulttool.png'">
            <div class="name ${tool.nameClass}">${tool.name}</div>
            <div class="category">${tool.kategorie}</div>
          `;
          div.addEventListener("click", ()=> {
            window.location.href = tool.file;
          });
          toolsContainer.appendChild(div);
        });
    }

    searchInput.addEventListener("input", renderTools);

    document.getElementById("settingsBtn").addEventListener("click", ()=>{
      window.location.href = "limbosettings2.html";
    });

    document.getElementById("listBtn").addEventListener("click", ()=>{
      window.scrollTo({top: toolsContainer.offsetTop, behavior:"smooth"});
    });

    loadTools();
  </script>
</body>
</html>
